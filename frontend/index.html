<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Docker Compose Explorer</title>
  <!-- Prism.js CSS for syntax highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
  <style>
    body { margin: 0; font-family: sans-serif; background-color: #f9fafb; }
    .navbar { 
      background-color: white; border-bottom: 1px solid #ddd; padding: 1rem 2rem; 
      display: none; /* 初期状態では非表示 */
    }
    .navbar.visible {
      display: block;
    }
    .navbar-content { 
      display: flex; align-items: center; gap: 1rem; 
      justify-content: space-between;
    }
    .navbar-left {
      display: flex; align-items: center; gap: 1rem;
    }
    .navbar-content .icon { font-size: 1.5rem; }
    .search-area { 
      padding: 2rem; text-align: center; 
      transition: all 0.3s ease;
    }
    .search-area.centered {
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      z-index: 10;
    }
    .search-area.normal {
      position: relative;
      transform: none;
    }
    .search-area.hidden {
      display: none;
    }
    .main-title {
      font-size: 2.5rem;
      font-weight: 300;
      color: #374151;
      margin-bottom: 2rem;
      letter-spacing: -0.025em;
    }
    #search-input {
      width: 50%; padding: 0.75rem 1rem; border-radius: 9999px;
      border: 1px solid #ccc; font-size: 1rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      transition: box-shadow 0.2s ease;
    }
    #search-input.in-navbar {
      width: 300px; font-size: 0.9rem;
      padding: 0.5rem 1rem;
    }
    #search-input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      border-color: #3b82f6;
    }
    .scroll-wrapper { 
      position: relative; padding: 2rem; overflow: hidden; 
      display: none; /* 初期状態では非表示 */
    }
    .scroll-wrapper.visible {
      display: block;
    }
    .card-container {
      display: flex; gap: 1rem; overflow-x: auto;
      scroll-behavior: smooth; padding: 1rem;
    }
    .card {
      background-color: white; border: 1px solid #ddd; border-radius: 1rem;
      width: 24rem; flex-shrink: 0; padding: 1rem; display: flex; flex-direction: column; height: 700px;
    }
    .card-header { margin-bottom: 0.5rem; color: #0365d6; }
    .card-header h2 { 
      font-size: 1rem; margin: 0; 
      display: flex; align-items: center; gap: 0.5rem;
    }
    .card-header .repo-icon {
      width: 16px; height: 16px; 
      color: #6b7280; flex-shrink: 0;
    }
    .card-header p { font-size: 0.8rem; color: #666; }
    .code-block {
      background-color: #fefefe; padding: 1rem; overflow-x: auto;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace; font-size: 0.85rem; border-radius: 0.5rem;
      white-space: pre; height: 100%; overflow-y: auto;
    }
    .code-block pre {
      margin: 0;
      background: none !important;
      padding: 0 !important;
    }
    .code-block code {
      background: none !important;
      padding: 0 !important;
      font-size: inherit !important;
    }
    .line { display: flex; }
    .line-number {
      width: 2rem; color: #999; text-align: right; margin-right: 1rem;
      user-select: none;
    }
    .line-code {
      flex: 1;
    }
    mark {
      background-color: #a7f3d0; /* 緑系の優しい色に変更 */
      color: #065f46; /* 濃い緑で視認性向上 */
      padding: 0.1em 0.2em; 
      border-radius: 0.2em;
    }
    
    /* Prism.jsのシンタックスハイライト色のカスタマイズ */
    .token.key {
      color: #2563eb !important; /* キーを青色に */
    }
    .token.string {
      color: #059669 !important; /* 文字列を緑色に */
    }
    .token.number {
      color: #dc2626 !important; /* 数値を赤色に */
    }
    .token.comment {
      color: #6b7280 !important; /* コメントをグレーに */
      font-style: italic;
    }
    .token.punctuation {
      color: #374151 !important; /* 句読点をダークグレーに */
    }
    .token.boolean {
      color: #7c3aed !important; /* ブール値を紫色に */
    }
    .scroll-btn {
      position: absolute; top: 50%; transform: translateY(-50%);
      width: 3rem; height: 3rem; border-radius: 9999px;
      background-color: white; border: 1px solid #ccc;
      cursor: pointer; z-index: 1; font-size: 1.25rem;
    }
         .scroll-btn.left { left: 1rem; }
     .scroll-btn.right { right: 1rem; }
     
           .loading-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 700px;
        font-size: 1.2rem;
        color: #6b7280;
        width: 100%;
        min-width: 100vw;
        position: relative;
        left: 50%;
        transform: translateX(-50%);
      }
           .loading-icon {
        font-size: 3rem;
        margin-right: 1rem;
        animation: spin 1s linear infinite;
      }
     @keyframes spin {
       from { transform: rotate(0deg); }
       to { transform: rotate(360deg); }
     }
  </style>
  <script src="https://code.iconify.design/iconify-icon/3.0.0/iconify-icon.min.js"></script>
</head>
<body>
  <nav class="navbar" id="navbar">
    <div class="navbar-content">
      <div class="navbar-left">
        <span class="icon"><iconify-icon icon="line-md:github-loop" width="36" height="36"></iconify-icon></span>
        <h1>Docker Compose Explorer</h1>
      </div>
      <div class="navbar-search" id="navbar-search" style="display: none;">
        <!-- 検索バーがここに移動される -->
      </div>
    </div>
  </nav>

  <div class="search-area centered" id="search-area">
    <h1 class="main-title">Dockerファイル生成ツール</h1>
    <input type="text" id="search-input" placeholder="Search for Docker Compose configurations..." />
  </div>

  <div class="scroll-wrapper" id="scroll-wrapper">
    <button class="scroll-btn left" onclick="scrollByAmount(-400)">←</button>
    <div class="card-container" id="card-container"></div>
    <button class="scroll-btn right" onclick="scrollByAmount(400)">→</button>
  </div>

  <script>
    function scrollByAmount(amount) {
      document.getElementById("card-container").scrollBy({ left: amount, behavior: "smooth" });
    }

    function createCard(file, terms) {
      const card = document.createElement("div");
      card.className = "card";

      const header = document.createElement("div");
      header.className = "card-header";
      header.innerHTML = `<h2>
        <svg class="repo-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="100%" height="100%" fill="currentColor">
          <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
        ${file.create}
      </h2><p>${file.description}</p>`;

      const codeDiv = document.createElement("div");
      codeDiv.className = "code-block";
      
      // コードを行ごとに分割
      const lines = file.dockercompose.trim().split("\n");
      
      // 各行を処理して行番号付きで表示
      lines.forEach((line, i) => {
        const lineDiv = document.createElement("div");
        lineDiv.className = "line";

        const lineNumber = document.createElement("span");
        lineNumber.className = "line-number";
        lineNumber.textContent = i + 1;

        const lineCodeWrapper = document.createElement("span");
        lineCodeWrapper.className = "line-code";
        
        // 一時的なcodeエレメントを作成してPrism.jsでハイライト
        const tempCode = document.createElement("code");
        tempCode.className = "language-yaml";
        tempCode.textContent = line;
        
        // Prism.jsでハイライト
        if (typeof Prism !== 'undefined') {
          Prism.highlightElement(tempCode);
        }
        
        lineCodeWrapper.innerHTML = tempCode.innerHTML;

        lineDiv.appendChild(lineNumber);
        lineDiv.appendChild(lineCodeWrapper);
        codeDiv.appendChild(lineDiv);
      });

      card.appendChild(header);
      card.appendChild(codeDiv);
      return card;
    }

    async function fetchAndRender(query = "") {
       const v = document.getElementById("search-input").value;
       console.log(v);
       
       // Loading表示を開始
       const container = document.getElementById("card-container");
       container.innerHTML = `
         <div class="loading-container">
           <iconify-icon icon="line-md:loading-twotone-loop" class="loading-icon"></iconify-icon>
           <span>Loading...</span>
         </div>
       `;

       // 初回検索時のみレイアウト変更
       const navbar = document.getElementById("navbar");
       const searchArea = document.getElementById("search-area");
       const scrollWrapper = document.getElementById("scroll-wrapper");
       const mainTitle = document.querySelector(".main-title");
       const searchInput = document.getElementById("search-input");
       const navbarSearch = document.getElementById("navbar-search");
       
       if (!navbar.classList.contains("visible")) {
         // 検索バーをナビゲーションバーに移動
         navbarSearch.appendChild(searchInput);
         navbarSearch.style.display = "block";
         searchInput.className = "in-navbar";
         
         navbar.className = "navbar visible";
         searchArea.className = "search-area hidden";
         scrollWrapper.className = "scroll-wrapper visible";
         
         // h1タイトルを削除
         if (mainTitle) {
           mainTitle.remove();
         }
       }
       
       try {
         const res = await fetch("https://app-8c454da6-195d-408c-800e-23226514c8dc.ingress.apprun.sakura.ne.jp/mock?q="+v);
         const json = await res.json();
         
         // 結果を表示
         container.innerHTML = "";
         const terms = query.toLowerCase().split(/\s+/).filter(Boolean);
         json.results.forEach(file => container.appendChild(createCard(file, terms)));
               } catch (error) {
          // エラー時の処理
          container.innerHTML = `
            <div class="loading-container">
              <span>エラーが発生しました。もう一度お試しください。</span>
            </div>
          `;
          console.error("検索エラー:", error);
        }
    }

    document.getElementById("search-input").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        fetchAndRender(e.target.value);
      }
    });
  </script>
  
  <!-- Prism.js JavaScript for syntax highlighting -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
</body>
</html>
