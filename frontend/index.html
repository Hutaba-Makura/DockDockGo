<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Docker Compose Explorer</title>
  <style>
    body { margin: 0; font-family: sans-serif; background-color: #f9fafb; }
    .navbar { 
      background-color: white; border-bottom: 1px solid #ddd; padding: 1rem 2rem; 
      display: none; /* 初期状態では非表示 */
    }
    .navbar.visible {
      display: block;
    }
    .navbar-content { display: flex; align-items: center; gap: 1rem; }
    .navbar-content .icon { font-size: 1.5rem; }
    .search-area { 
      padding: 2rem; text-align: center; 
      transition: all 0.3s ease;
    }
    .search-area.centered {
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      z-index: 10;
    }
    .search-area.normal {
      position: relative;
      transform: none;
    }
    .main-title {
      font-size: 2.5rem;
      font-weight: 300;
      color: #374151;
      margin-bottom: 2rem;
      letter-spacing: -0.025em;
    }
    #search-input {
      width: 50%; padding: 0.75rem 1rem; border-radius: 9999px;
      border: 1px solid #ccc; font-size: 1rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      transition: box-shadow 0.2s ease;
    }
    #search-input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      border-color: #3b82f6;
    }
    .scroll-wrapper { 
      position: relative; padding: 2rem; overflow: hidden; 
      display: none; /* 初期状態では非表示 */
    }
    .scroll-wrapper.visible {
      display: block;
    }
    .card-container {
      display: flex; gap: 1rem; overflow-x: auto;
      scroll-behavior: smooth; padding: 1rem;
    }
    .card {
      background-color: white; border: 1px solid #ddd; border-radius: 1rem;
      width: 24rem; flex-shrink: 0; padding: 1rem; display: flex; flex-direction: column; height: 600px;
    }
    .card-header { margin-bottom: 0.5rem; }
    .card-header h2 { font-size: 1rem; margin: 0; }
    .card-header p { font-size: 0.8rem; color: #666; }
    .code-block {
      background-color: #f1f5f9; padding: 1rem; overflow-x: auto;
      font-family: monospace; font-size: 0.85rem; border-radius: 0.5rem;
      white-space: pre; height: 100%; overflow-y: auto;
    }
    .line { display: flex; }
    .line-number {
      width: 2rem; color: #999; text-align: right; margin-right: 1rem;
      user-select: none;
    }
    mark {
      background-color: #fde68a; padding: 0.1em 0.2em; border-radius: 0.2em;
    }
    .scroll-btn {
      position: absolute; top: 50%; transform: translateY(-50%);
      width: 3rem; height: 3rem; border-radius: 9999px;
      background-color: white; border: 1px solid #ccc;
      cursor: pointer; z-index: 1; font-size: 1.25rem;
    }
    .scroll-btn.left { left: 1rem; }
    .scroll-btn.right { right: 1rem; }
  </style>
  <script src="https://code.iconify.design/iconify-icon/3.0.0/iconify-icon.min.js"></script>
</head>
<body>
  <nav class="navbar" id="navbar">
    <div class="navbar-content">
      <span class="icon"><iconify-icon icon="line-md:github-loop" width="36" height="36"></iconify-icon></span>
      <h1>Docker Compose Explorer</h1>
    </div>
  </nav>

  <div class="search-area centered" id="search-area">
    <h1 class="main-title">Dockerファイル生成ツール</h1>
    <input type="text" id="search-input" placeholder="Search for Docker Compose configurations..." />
  </div>

  <div class="scroll-wrapper" id="scroll-wrapper">
    <button class="scroll-btn left" onclick="scrollByAmount(-400)">←</button>
    <div class="card-container" id="card-container"></div>
    <button class="scroll-btn right" onclick="scrollByAmount(400)">→</button>
  </div>

  <script>
    function scrollByAmount(amount) {
      document.getElementById("card-container").scrollBy({ left: amount, behavior: "smooth" });
    }

    function highlight(text, terms) {
      if (!terms.length) return text;
      const escapedTerms = terms.map(t => t.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"));
      const pattern = new RegExp(`(${escapedTerms.join("|")})`, "gi");
      return text.replace(pattern, match => `<mark>${match}</mark>`);
    }

    function createCard(file, terms) {
      const card = document.createElement("div");
      card.className = "card";

      const header = document.createElement("div");
      header.className = "card-header";
      header.innerHTML = `<h2>${file.create}</h2><p><iconify-icon icon="line-md:text-box-multiple" width="15" height="15"></iconify-icon> ${file.description}</p>`;

      const codeDiv = document.createElement("div");
      codeDiv.className = "code-block";
      const lines = file.dockercompose.trim().split("\n");
      lines.forEach((line, i) => {
        const lineDiv = document.createElement("div");
        lineDiv.className = "line";

        const lineNumber = document.createElement("span");
        lineNumber.className = "line-number";
        lineNumber.textContent = i + 1;

        const lineCode = document.createElement("span");
        lineCode.innerHTML = highlight(line, terms);

        lineDiv.appendChild(lineNumber);
        lineDiv.appendChild(lineCode);
        codeDiv.appendChild(lineDiv);
      });

      card.appendChild(header);
      card.appendChild(codeDiv);
      return card;
    }

    async function fetchAndRender(query = "") {
      const v = document.getElementById("search-input").value;
      console.log(v);
      const res = await fetch("https://app-8c454da6-195d-408c-800e-23226514c8dc.ingress.apprun.sakura.ne.jp/mock?q="+v);
      const json = await res.json();
      const container = document.getElementById("card-container");
      container.innerHTML = "";
      const terms = query.toLowerCase().split(/\s+/).filter(Boolean);
      json.results.forEach(file => container.appendChild(createCard(file, terms)));
      
      // 検索実行後、レイアウトを通常表示に変更
      const navbar = document.getElementById("navbar");
      const searchArea = document.getElementById("search-area");
      const scrollWrapper = document.getElementById("scroll-wrapper");
      const mainTitle = document.querySelector(".main-title");
      
      navbar.className = "navbar visible";
      searchArea.className = "search-area normal";
      scrollWrapper.className = "scroll-wrapper visible";
      
      // h1タイトルを削除
      if (mainTitle) {
        mainTitle.remove();
      }
    }

    document.getElementById("search-input").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        fetchAndRender(e.target.value);
      }
    });
  </script>
</body>
</html>
